{"version":3,"file":"bundle.js","sources":["../../src/js/index.js"],"sourcesContent":["// M O D E L  ******************************************************************************************\n\nvar model = {\n    //---------------------------\n    // if debug == true logs go to console.\n    debug: false,\n    oauth2email: \"\",\n    oauth2name: \"\",\n    oauth2id: \"\",\n\n    //---------------------------\n    // url of GraphQL endpoint = appurl + '/graphql'\n    priv_origin: null, \n    set appurl(v){\n        this.priv_origin = v\n        document.getElementById('appUrl').innerHTML = '&#x21E2;&nbsp;'+v\n        buildSocialIcons(v+\"/oauthproviders\")\n        document.getElementById('graphqlTestLink').href = 'https://graphql-test.vercel.app/?end_point='+v+'/schema&tab_name=auth-proxy'\n    },\n    get appurl(){\n        return this.priv_origin\n    },\n    //---------------------------\n    // templatesCache keeps loaded templates, not to load them repeatedly\n    templatesCache :[],\n\n    //---------------------------\n    get logined(){\n         return (this._loginedUser != null)\n    },\n \n\n    //---------------------------\n    urlParams: new URLSearchParams(window.location.search),\n    //---------------------------\n    _loginedUser: null,\n    set loginedUser(v) {\n        this._loginedUser = v\n        if (v) {\n            document.getElementById(\"userTab\").innerText = v.username\n            // getAuthRoles(model.loginedUser.username)\n        } else {\n            document.getElementById(\"userTab\").innerText = \"\"\n        }\n        refreshApp()\n    },\n    get loginedUser() {\n        return this._loginedUser\n    },\n\n    //---------------------------\n    _selfRegAllowed: false,\n    set selfRegAllowed(v) {\n        this._selfRegAllowed = v\n        if (v) {\n            showElements(\"#selfRegButton\")\n            showElements(\"#selfRegHelp\")\n        } else {\n            hideElements(\"#selfRegButton\")\n            hideElements(\"#selfRegHelp\")\n        }\n    },\n    get selfRegAllowed() {\n        return this._selfRegAllowed\n    },\n    \n    //---------------------------\n    _captchaRequired: false,\n    set captchaRequired(v) {\n        this._captchaRequired = v\n        if (v) {\n            showElements(\"#captcha\")\n        } else {\n            hideElements(\"#captcha\")\n        }\n    },\n    get captchaRequired() {\n        return this._captchaRequired\n    },\n\n    //---------------------------\n    _authRoles: null,\n    set authRoles(v) {\n        this._authRoles = v\n        if (this.isAdmin){\n            showElements('#usersTab')\n            showElements('#rolesTab')\n            showElements('#graphqlTest')\n            showElements('#btnNewApp')\n            showElements('#settingsButton')\n        } else {\n            hideElements('#usersTab')\n            hideElements('#rolesTab')\n            hideElements('#graphqlTest')\n            hideElements('#btnNewApp')\n            hideElements('#settingsButton')\n\n            // showPage('apps')\n        }\n        renderTemplateFile('mustache/apps.html', model, '.app-search-results')\n        \n    },\n    get authRoles() {\n        return this._authRoles\n    },\n    get isAdmin() {\n        if (!model.authRoles) return false\n        return model.authRoles.some(e => (e.rolename == \"authadmin\" || e.rolename == \"auditor\"))\n    },\n    \n    //---------------------------\n    _user: null,\n    set user(v) {\n        this._user = v\n        renderTemplateFile('mustache/user.html', model, '#userPage')\n    },\n    get user() {\n        return this._user\n    },\n    \n    //---------------------------\n    _app: null,\n    set app(v) {\n        this._app = v\n        renderTemplateFile('mustache/app.html', model, '#appPage')\n    },\n    get app() {\n        return this._app\n    },\n    \n    //---------------------------\n    _users: null,\n    set users(v) {\n        this._users = v\n        renderTemplateFile('mustache/users.html', model, '.user-search-results')\n    },\n    get users() {\n        return this._users\n    },\n    \n    //---------------------------\n    _apps: null,\n    set apps(v) {\n        this._apps = v\n        renderTemplateFile('mustache/apps.html', model, '.app-search-results')\n    },\n    get apps() {\n        return this._apps\n    },\n\n    //---------------------------\n    all_app_options: null,\n    all_user_options:null,\n    //---------------------------\n    _allApps: null,\n    set allApps(v) {\n        this._allApps = v\n        this.all_app_options = createOptions(v, \"appname\", \"description\", \"url\")\n        document.querySelector(\"#allAppsDataList\").innerHTML = this.all_app_options\n    },\n    get allApps() {\n        return this._allApps\n    },\n\n    //---------------------------\n    _allUsers: null,\n    set allUsers(v) {\n        this._allUsers = v\n        this.all_user_options = createOptions(v, \"username\", \"fullname\", \"email\")\n        document.querySelector(\"#allUsersDataList\").innerHTML = this.all_user_options\n    },\n    get allUsers() {\n        return this._allUsers\n    },\n    \n    //---------------------------\n    _app_user_roles: null,\n    set app_user_roles(v) {\n        this._app_user_roles = v\n        renderTemplateFile('mustache/roles.html', model, '.app-user-roles-results')\n    },\n    get app_user_roles() {\n        return this._app_user_roles\n    },\n\n    //---------------------------\n    _params: null,\n    set params(v) {\n        this._params = v\n        renderTemplateFile('mustache/params.html', model, '#paramsPage')\n    },\n    get params() {\n        return this._params\n    },\n\n    //---------------------------\n    _appstat: null,\n    set appstat(v) {\n        this._appstat = v\n        if (! document.getElementById('gauges')) return\n\n        document.getElementById('divSys').innerText = v.sys +' Mb'\n        document.getElementById('divAlloc').innerText = 'allocated: '+v.alloc +' Mb'\n        document.getElementById('divTotalAlloc').innerText = 'total allocated: '+v.total_alloc +' Mb'\n\n\n        drawGauge(\"req / day\", v.requests_per_day, 0,  \"divDay\")        // 10000\n        drawGauge(\"req / hour\", v.requests_per_hour, 0, \"divHour\")       // 1000\n        drawGauge(\"req / min\", v.requests_per_minute, 0, \"divMinute\")     // 100\n        drawGauge(\"req / sec\", v.requests_per_second, 0, \"divSecond\")      // 10\n    },\n    get appstat() {\n        return this._appstat\n    },\n\n \n    \n}\n\n\n\n// F U N C T I O N S  *********************************************************************************\n\nfunction createOptions(selectValues, keyProp, textProp1, textProp2) {\n    var output = []\n    selectValues && selectValues.forEach(function(value)\n    {\n      output.push(`<option value=\"${value[keyProp]}\">${value[textProp1]} &nbsp;&nbsp;&nbsp; ${value[textProp2]?value[textProp2]:''}</option>`);\n    })\n    let optionText = output.join('')\n    return optionText\n}\n\n\nfunction highlightTab(tabid) {\n        removeClass('.tab', \"underlined\")\n        var tabid0 = tabid.split(\"/\")[0]\n        addClass('#'+tabid0+'Tab', \"underlined\")   \n}\n\n\nfunction showPage(pageid, dontpush){\n    stopGettingAppstat()\n\n    //распарсить pageidExtended\n    var a = pageid.split(\"/\")\n    var pageid0 = a[0]\n    var id = a[1]\n\n    highlightTab(pageid)\n    \n    hideElements('.page')\n    showElements('#'+pageid0+'Page')\n\n\n    // setting focus\n    var text = document.querySelector('#'+pageid0+'Page input[type=\"text\"]')\n    if(text) \n        text.focus()\n\n\n    if (!dontpush){\n        if (!history.state || history.state.pageid != pageid ){\n            history.pushState({pageid:pageid},pageid, \"#\"+pageid) \n        }\n    }\n\n    if (id) {\n        if (pageid0 == \"app\"){\n            getApp(id)\n        } \n        if (pageid0 == \"user\"){\n            getUser(id)\n        }\n    }\n\n    if (pageid0 == 'params')\n        startGettingAppstat()\n\n    return false\n}\n\n\nfunction renderTemplateFile(templateFile, data, targetSelector) {\n    var cachedTemlpate = model.templatesCache[templateFile]\n    \n    if (cachedTemlpate) {\n        renderTemplate(cachedTemlpate) \n        // console.info(\"from cache:\",templateFile)\n        return\n    }\n    \n    fetch(templateFile).then(x => x.text()).then( t => {\n        model.templatesCache[templateFile]=t \n        renderTemplate(t)\n    })\n\n    function renderTemplate(template) {\n        var rendered = Mustache.render(template, data)\n        document.querySelector(targetSelector).innerHTML = rendered\n    }    \n\n}\n\n\n\nvar delayTimeout\nfunction delayFunc(f, delay=500) {\n   clearTimeout(delayTimeout) \n   delayTimeout = setTimeout(f, delay)  \n   return false \n}\n\n\nfunction searchApps() {\n    if (document.querySelector('#chkLocalSearch').checked) {\n        return delayFunc(searchAppsInModel, 100)\n    } else {\n        return delayFunc(formListAppSubmit)\n    }\n}\n\nfunction searchAppsInModel() {\n    if (!model.allApps) return\n    var text = document.querySelector(\"#formListApp input[name='search']\").value.trim().replace(' ','.*')\n    var r = new RegExp(text, 'i')\n    let found = model.allApps.filter((v)=>{\n        var s = Object.values(v).join(' ')\n        return r.test(s)\n    })\n    model.apps = found\n    return false   \n}\n\n\nfunction sortAppsBy(prop) {\n    if (!model._allApps) return false\n    model._allApps.sort( (a,b) => (a[prop]+a.appname)>(b[prop]+b.appname)? 1: -1)\n    model._apps.sort( (a,b) => (a[prop]+a.appname)>(b[prop]+b.appname)? 1: -1 )\n    model.apps = model._apps\n    return false\n}\n\n\nfunction searchUsers() {\n    if (document.querySelector('#chkLocalSearch').checked) {\n        return delayFunc(searchUsersInModel, 100)\n    } else {\n        return delayFunc(formListUserSubmit)\n    }\n}\n\n\nfunction searchUsersInModel() {\n    if (!model.allUsers) return\n    var text = document.querySelector(\"#formListUser input[name='search']\").value.trim().replace(' ','.*')\n    var r = new RegExp(text, 'i')\n    let found = model.allUsers.filter( (v) => r.test (Object.values(v).join(' ')) )\n    model.users = found\n    return false   \n}\n\n\nfunction sortUsersBy(prop, asStings = true) {\n    if (!model._allUsers) return false\n    if (asStings){\n        model._allUsers.sort( (a,b) => (a[prop]+a.username)>(b[prop]+b.username)? 1: -1)\n        model._users.sort( (a,b) => (a[prop]+a.username)>(b[prop]+b.username)? 1: -1 )\n    } else {\n        model._allUsers.sort( (a,b) => (a[prop])>(b[prop])? 1: -1)\n        model._users.sort( (a,b) => (a[prop])>(b[prop])? 1: -1 )\n    }\n    model.users = model._users\n    return false\n}\n\n\n\n// R E Q U E S T S  *******************************************************\n\nfunction doGraphQLRequest(query, responseHandler, errorElementID) {\n    fetch(model.appurl+'/graphql', { \n        method: 'POST', \n        credentials: 'include', \n        body: JSON.stringify({ query: query, variables: {} }) \n    })\n        .then(res => { \n            if (res.ok) {\n                return res.json();\n            }\n            new Error(res)\n        })\n        .then((res) => {\n            model.debug && console.log(res)\n            if (res.errors){\n                model.debug && console.log(res.errors[0].message)\n                if (errorElementID) {\n                    document.getElementById(errorElementID).innerText = res.errors[0].message\n                }\n                return\n            }\n            responseHandler && responseHandler(res)\n        })\n        .catch( e => console.error(e) )    \n    \n}\n\n\n// L O G I N  *****************************************************************************\n\nfunction loginGraphQLFormSubmit(event) {\n    if (event) event.preventDefault()\n    \n    let username = document.getElementById(\"loginUsername\").value\n    let password = document.getElementById(\"loginPassword\").value\n    let captcha =  document.getElementById(\"loginCaptcha\").value\n    let pin =  document.getElementById(\"loginPin\").value\n\n    isPinRequired(username)\n    \n\n    let query =`\n    query {\n        login(\n        username: \"${username}\",\n        password: \"${password}\",\n        captcha: \"${captcha}\",\n        pin: \"${pin}\"\n        )\n        }    \n    `\n    function onSuccess(res){\n        getLoginedUser()\n    }   \n    \n    doGraphQLRequest(query, onSuccess, \"loginError\")\n    clearLoginForm()\n    return false       \n}\n\n\n\nfunction logoutGraphQLFormSubmit(event) {\n    if (event) event.preventDefault()\n    var query =`\n    query {\n        logout {\n            message\n            username\n          }\n        }\n    `\n\n    function onSuccess(res){\n        model.loginedUser = null\n        model.oauth2email =\"\"\n        model.oauth2id =\"\"\n        model.oauth2name =\"\"\n\n        refreshApp()\n    }\n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\n\nfunction isSelfRegAllowed(event) {\n    if (event) event.preventDefault()\n    var query =` query { is_selfreg_allowed }`\n\n    function onSuccess(res){\n        model.selfRegAllowed = res.data.is_selfreg_allowed\n    }\n       \n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\nfunction checkUserRequirements(event) {\n    if (event) event.preventDefault()\n    let username = document.getElementById(\"loginUsername\").value   \n    isCaptchaRequired(username)\n    isPinRequired(username)\n    return false \n}\n\n\nfunction isCaptchaRequired(username) {\n    var query =`  query { is_captcha_required(  username: \"${username}\" ) \n        {\n            is_required \n            path\n        } \n    } `\n\n    function onSuccess(res){\n        model.captchaRequired = res.data.is_captcha_required.is_required\n        if (model.captchaRequired) {\n            getNewCaptcha()\n            model.debug && console.log(\"Captcha IS required\")\n        }\n    }\n       \n    doGraphQLRequest(query, onSuccess)   \n}\n\nfunction isPinRequired(username) {\n    var query =`  query { is_pin_required(  username: \"${username}\" ) \n        {\n            use_pin \n            pinrequired\n            pinset\n        } \n    } `\n\n    function onSuccess(res){\n        let r = res.data.is_pin_required;\n        console.debug(\"isPinRequired()->\", r);\n        (r.use_pin && r.pinrequired) ? showElements(\".pinclass\") : hideElements(\".pinclass\"); \n    }\n       \n    doGraphQLRequest(query, onSuccess)   \n}\n\n\n\nfunction resetPassword(event) {\n    if (event) event.preventDefault()\n\n    let username = document.getElementById(\"loginUsername\").value\n\n    var query =`\n    mutation {\n        generate_password(\n        username: \"${username}\"\n        ) \n        }\n    `\n    function onSuccess(res){\n        alert(res.data.generate_password)\n        refreshApp()\n    }   \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\nfunction resetAuthenticator(event) {\n    if (event) event.preventDefault()\n    console.debug(model.priv_origin)\n    let username = document.getElementById(\"loginUsername\").value\n    if (!username) {\n        alert('Заполните поле имя пользователя или email')\n        return false\n    }\n    let url = `${model.priv_origin}/reset_authenticator/${username}`\n    fetch(url).then( r => r.json()).then(onSuccess).catch(onError)\n    \n    function onSuccess(res){\n        console.debug(res)\n        document.getElementById(\"loginError\").innerText = res.err || \"\"\n        if (!res.err) {\n             alert(res.result)\n        }\n    }\n\n    function onError(err){\n        console.debug(\"ERR: \"+err)\n    }\n\n    return false \n}\n\n\n\n// L O G I N E D   U S E R   **********************************************************************************************************************\n\n\nfunction getLoginedUser() {\n    model.loginedUser = null\n    var query =`\n    query {\n        get_logined_user {\n            description\n            email\n            fullname\n            username\n            disabled\n            id\n            pinhash\n            pinrequired\n            pinset      \n        }\n    }\n    `\n    \n    function onSuccess(res){\n        model.loginedUser = res.data.get_logined_user\n        getAuthRoles(model.loginedUser.username)\n        getUser(model.loginedUser.username)\n    } \n    \n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\nfunction getAuthRoles(username) {\n    model.authRoles = null\n\n    var query =`\n    query {\n        list_app_user_role(\n            appname: \"auth\",\n            username: \"${username}\"\n            ) {\n                rolename\n            }\n        }\n        `\n\n    function onSuccess(res){\n        model.authRoles = res.data.list_app_user_role\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n// P A R A M S  ***********************************************************************************************************************\n\n\nfunction getParams() {\n    model.params = null\n    var query =`\n    query {\n        get_params {\n            max_attempts\n            reset_time\n            selfreg\n            use_captcha\n            use_pin\n          }\n        }\n    `\n\n    function onSuccess(res){\n        var p = res.data.get_params\n        model.params = p\n        getAppstatRest()\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\nfunction setParams(event) {\n    if (event) event.preventDefault()\n    let selfreg =       document.querySelector(\"#formParams input[name='selfreg']\").checked\n    let use_captcha =   document.querySelector(\"#formParams input[name='use_captcha']\").checked\n    let use_pin =       document.querySelector(\"#formParams input[name='use_pin']\").checked\n    let max_attempts =  document.querySelector(\"#formParams input[name='max_attempts']\").value\n    let reset_time =    document.querySelector(\"#formParams input[name='reset_time']\").value\n    \n    var query =`\n    query {\n        set_params(\n        selfreg:      ${selfreg},\n        use_captcha:  ${use_captcha},\n        use_pin:      ${use_pin},\n        max_attempts: ${max_attempts},\n        reset_time:   ${reset_time}\n        ) {\n            max_attempts\n            reset_time\n            selfreg\n            use_captcha\n            use_pin\n          }\n        }\n    `\n\n    function onSuccess(res){\n        model.params = res.data.set_params\n        alert(\"params saving success\")\n    }\n\n    doGraphQLRequest(query, onSuccess, \"paramsError\")\n    return false       \n}\n\n\n// function getAppstat(event) {\n//     if (event) event.preventDefault()\n//     var query =`\n//     query {\n//         get_stat {\n//             alloc\n//             requests_per_day\n//             requests_per_hour\n//             requests_per_minute\n//             requests_per_second\n//             sys\n//             total_alloc\n//           }\n//         }\n//     `\n\n//     function onSuccess(res){\n//         var m = res.data.get_stat\n//         model.appstat = m\n//     } \n\n//     doGraphQLRequest(query, onSuccess, \"appstatError\")\n//     return false       \n// }\n\nfunction getAppstatRest(event) {\n    if (event) event.preventDefault()\n    getAppstatRest.counter = getAppstatRest.counter === undefined ? 0: getAppstatRest.counter+1\n    console.log(\"getAppstatRest.counter = \",getAppstatRest.counter)\n\n\n    fetch(model.appurl + \"/stat\").then(x => x.json())\n    .then( onSuccess )\n    .catch( err => {\n        console.log(\"fetch error:\",err)\n        return\n        }\n    )  \n\n    function onSuccess(res){\n        var m = res\n        model.appstat = m\n    } \n    return false       \n}\n\nmodel.statInterval = null\nfunction startGettingAppstat(){\n    clearInterval(model.statInterval)\n    getAppstatRest()\n    model.statInterval = setInterval(getAppstatRest, 3000)\n    console.log('startGettingAppstat')\n}\n\nfunction stopGettingAppstat(){\n    clearInterval(model.statInterval)\n    console.log('stopGettingAppstat')\n}\n\n// U S E R S  ***********************************************************************************************************************\n\n\nfunction formListUserSubmit(event) {\n    if (event) event.preventDefault()\n    model.users = null\n    let search = document.querySelector(\"#formListUser input[name='search']\").value\n    \n    var query =`\n    query {\n        list_user(\n        search: \"${search}\",\n        order: \"fullname ASC\"\n        ) {\n            length\n            list {\n              description\n              email\n              fullname\n              username\n              disabled\n              id\n              pinhash\n              pinrequired\n              pinset        \n              }\n          }\n        }        \n    `\n    \n    function onSuccess(res){\n        model.users = res.data.list_user.list\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\n\n\nfunction updateUser(event) {\n    if (event) event.preventDefault()\n    let old_username =  document.querySelector(\"#formUser input[name='old_username']\").value\n    let username =      document.querySelector(\"#formUser input[name='username']\").value\n    let password =      document.querySelector(\"#formUser input[name='password']\").value\n    let email    =      document.querySelector(\"#formUser input[name='email']\").value\n    let fullname =      document.querySelector(\"#formUser input[name='fullname']\").value\n    let description =   document.querySelector(\"#formUser *[name='description']\").value\n    let disabled =      document.querySelector(\"#formUser input[name='disabled']\").value\n    let pinhash =       document.querySelector(\"#formUser input[name='pinhash']\").value\n    let pinrequired =   document.querySelector(\"#formUser input[name='pinrequired']\").checked\n    let pinset =        document.querySelector(\"#formUser input[name='pinset']\").checked\n    \n    var query =`\n    mutation {\n        update_user(\n        old_username: \"${old_username}\",\n        username: \"${username}\",\n        password: \"${password}\",\n        email: \"${email}\",\n        fullname: \"${fullname}\",\n        description: \"${description}\",\n        disabled: ${disabled},\n        pinhash: \"${pinhash}\",\n        pinrequired: ${pinrequired},\n        pinset: ${pinset}\n        ) {\n            description\n            email\n            fullname\n            username\n            disabled\n            id\n            pinhash\n            pinrequired\n            pinset        \n          }\n\n        }\n    `\n\n    function onSuccess(res){\n        alert(\"update_user success\")\n        refreshData()\n        model.user = res.data[\"update_user\"]\n        getUser(username)\n    }\n\n    doGraphQLRequest(query, onSuccess, \"userError\")\n    return false       \n}\n\n\nfunction createUser(event) {\n    if (event) event.preventDefault()\n    let username =      document.querySelector(\"#formUser input[name='username']\").value\n    let password =      document.querySelector(\"#formUser input[name='password']\").value\n    let email    =      document.querySelector(\"#formUser input[name='email']\").value\n    let fullname =      document.querySelector(\"#formUser input[name='fullname']\").value\n    let description =   document.querySelector(\"#formUser *[name='description']\").value\n    let disabled =      document.querySelector(\"#formUser input[name='disabled']\").value\n    let pinhash =       document.querySelector(\"#formUser input[name='pinhash']\").value\n    let pinrequired =   document.querySelector(\"#formUser input[name='pinrequired']\").checked\n    let pinset =        document.querySelector(\"#formUser input[name='pinset']\").checked\n    \n    var query =`\n    mutation {\n        create_user(\n        username: \"${username}\",\n        password: \"${password}\",\n        email: \"${email}\",\n        fullname: \"${fullname}\",\n        description: \"${description}\",\n        disabled: ${disabled},\n        pinhash: \"${pinhash}\",\n        pinrequired: ${pinrequired},\n        pinset: ${pinset}\n        ) {\n            description\n            email\n            fullname\n            username\n            disabled\n            id\n            pinhash\n            pinrequired \n            pinset       \n          }\n\n        }\n    `\n\n    function onSuccess(res){\n        alert(\"create_user success\")\n        refreshData()\n        model.user = res.data[\"create_user\"]\n        if (!model.logined) {\n            alert(`\"${username}\" is created.` )\n            showPage('login',true)\n        }\n        getUser(username)\n    }\n\n    doGraphQLRequest(query, onSuccess, \"userError\")\n    return false       \n}\n\n\nfunction getUser(username) {\n    model.user = null\n    var query =`\n    query {\n        get_user(\n        username: \"${username}\"\n        ) {\n            description\n            email\n            fullname\n            username\n            disabled\n            id\n            pinhash\n            pinrequired\n            pinset     \n          }\n        \n        list_app_user_role(\n        username: \"${username}\"\n        ) {\n            app_description\n            appname\n            rolename\n            username\n          }\n        \n        }\n\n    `\n\n    function onSuccess(res){\n        var u = res.data.get_user\n        u.apps = groupApps(res.data.list_app_user_role)\n        // render \n        model.user = u\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\n\nfunction groupApps(list_app_user_role) {\n    if (!list_app_user_role) return []\n    \n    let gr = {}\n    for (let aur of list_app_user_role ){\n        if (!gr[aur.appname]) gr[aur.appname] =[]\n        gr[aur.appname].push(aur)\n    }\n\n    let arr = []\n\n    for (let [key, value] of Object.entries(gr)) {\n        let rec = {}\n        rec.appname =key\n        rec.app_description = value[0].app_description\n        rec.items = value\n        arr.push(rec)\n    }\n    return arr\n}\n\n\n\nfunction deleteUser(username) {\n    var query =`\n    mutation {\n        delete_user(\n        username: \"${username}\"\n        ) {\n            username\n          }\n        }\n    `\n    function onSuccess(res){\n        model.user = null\n        refreshData()\n        showPage('users')\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\n// A P P S  *******************************************************************\n\nfunction formListAppSubmit(event) {\n    if (event) event.preventDefault()\n    model.apps = null\n    let search = document.querySelector(\"#formListApp input[name='search']\").value\n    var query =`\n    query {\n        list_app(\n        search: \"${search}\",\n        order: \"description ASC\"\n        ) {\n            length\n            list {\n              appname\n              description\n              url\n              rebase\n              public\n              sign\n            }\n          }\n        }    `\n\n    function onSuccess(res){\n        model.apps = res.data.list_app.list\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\n\n\nfunction createApp(event) {\n    if (event) event.preventDefault()\n    let appname =     document.querySelector(\"#formApp input[name='appname']\"    ).value\n    let url =         document.querySelector(\"#formApp input[name='url']\"        ).value\n    let description = document.querySelector(\"#formApp input[name='description']\").value\n    let rebase =      document.querySelector(\"#formApp input[name='rebase']\"     ).value\n    let _public =     document.querySelector(\"#formApp input[name='public']\"     ).value\n    let sign =        document.querySelector(\"#formApp input[name='sign']\"       ).value\n    \n    var query =`\n    mutation {\n        create_app(\n        appname: \"${appname}\",\n        url: \"${url}\",\n        description: \"${description}\",\n        rebase: \"${rebase}\",\n        public: \"${_public}\",\n        sign: \"${sign}\"\n        ) {\n            description\n            appname\n            url\n            rebase\n            public\n            sign\n          }\n\n        }\n    `\n    function onSuccess(res){\n        alert(\"create_app success\")\n        refreshData()\n        model.app = res.data[\"create_app\"]\n        getApp(appname)\n    } \n\n    doGraphQLRequest(query, onSuccess, \"appError\")\n    return false       \n}\n\n\nfunction updateApp(event, appOperationName = 'create_app') {\n    if (event) event.preventDefault()\n    let old_appname = document.querySelector(\"#formApp input[name='old_appname']\"    ).value\n    let appname =     document.querySelector(\"#formApp input[name='appname']\"    ).value\n    let url =         document.querySelector(\"#formApp input[name='url']\"        ).value\n    let description = document.querySelector(\"#formApp input[name='description']\").value\n    let rebase =      document.querySelector(\"#formApp input[name='rebase']\"     ).value\n    let _public =     document.querySelector(\"#formApp input[name='public']\"     ).value\n    let sign =        document.querySelector(\"#formApp input[name='sign']\"       ).value\n    \n    var query =`\n    mutation {\n        update_app(\n        old_appname: \"${old_appname}\",\n        appname: \"${appname}\",\n        url: \"${url}\",\n        description: \"${description}\",\n        rebase: \"${rebase}\",\n        public: \"${_public}\",\n        sign: \"${sign}\"\n        ) {\n            description\n            appname\n            url\n            rebase\n            public\n            sign\n          }\n\n        }\n    `\n    function onSuccess(res){\n        alert(\"update_app success\")\n        refreshData()\n        model.app = res.data[\"update_app\"]\n        getApp(appname)\n    } \n\n    doGraphQLRequest(query, onSuccess, \"appError\")\n    return false       \n}\n\n\n\n\n\nfunction getApp(appname) {\n    model.app = null\n\n    var query =`\n    query {\n        get_app(\n        appname: \"${appname}\"\n        ) {\n            description\n            appname\n            url\n            rebase\n            public\n            sign\n          }\n        \n        list_app_user_role(\n        appname: \"${appname}\"\n        ) {\n            appname\n            rolename\n            user_fullname\n            user_disabled\n            username\n          }\n        \n        }\n\n    `\n\n    function onSuccess(res){\n        var a = res.data.get_app\n        a.users = groupUsers(res.data.list_app_user_role)\n        // render\n        model.app = a\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction groupUsers(list_app_user_role) {\n    let gr = {}\n    for (let aur of list_app_user_role ){\n        if (!gr[aur.username]) gr[aur.username] =[]\n        gr[aur.username].push(aur)\n    }\n\n    let arr = []\n\n    for (let [key, value] of Object.entries(gr)) {\n        let rec = {}\n        rec.username =key\n        rec.user_fullname = value[0].user_fullname\n        rec.items = value\n        arr.push(rec)\n    }\n    return arr\n}\n\n\n\nfunction deleteApp(appname) {\n    var query =`\n    mutation {\n        delete_app(\n        appname: \"${appname}\"\n        ) {\n            appname\n          }\n        }\n    `\n    function onSuccess(res){\n        model.app = null\n        refreshData()\n        showPage('apps') ;\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\n\n\n// A P P   U S E R   R O L E   **************************************************************************************************\n\nfunction getAllApps(event) {\n    if (event) event.preventDefault()\n    model.allApps = null\n    var query =`\n    query {\n        list_app(\n        order: \"appname ASC\"\n        ) {\n            length\n            list {\n              appname\n              description\n              url\n              rebase\n              public \n              sign\n            }\n          }\n        }    `\n\n    function onSuccess(res){\n        model.allApps = res.data.list_app.list\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction getAllUsers(event) {\n    if (event) event.preventDefault()\n    model.allUsers = null\n    var query =`\n    query {\n        list_user(\n        order: \"fullname ASC\"\n        ) {\n            length\n            list {\n              username\n              fullname\n              email\n              description\n              disabled\n              id\n              pinhash\n              pinrequired\n              pinset       \n              }\n          }\n        }    `\n\n    function onSuccess(res){\n        model.allUsers = res.data.list_user.list\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\nfunction formListRoleSubmit(event) {\n    if (event && event.preventDefault ) event.preventDefault()\n    model.app_user_roles = null\n    let appname =  document.getElementById(\"allApps\").value\n    let username = document.getElementById(\"allUsers\").value\n    if (!appname || !username) \n        return\n\n    var query =`\n    query {\n        list_app_user_role(\n        appname: \"${appname}\",\n        username: \"${username}\"\n        ) {\n            rolename\n          }\n        }        \n        `\n\n    function onSuccess(res){\n        model.app_user_roles = res.data.list_app_user_role\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction modifyRole(action,appname,username,rolename, onsuccess ) {\n    if (!appname || !username || !rolename) return\n\n    var query =`\n    mutation {\n        ${action}_app_user_role(\n        appname: \"${appname}\",\n        username: \"${username}\",\n        rolename: \"${rolename}\"\n        ) {\n            rolename\n            appname\n            username\n          }\n        }\n    `\n    function onSuccess(res){\n        if (onsuccess) onsuccess()\n    }\n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n// works when input values on roles page change\nfunction refreshRoles() {\n    let allUsersValue = document.getElementById(\"allUsers\").value\n    if (allUsersValue) {\n        let ui = document.querySelector(`#allUsersDataList>option[value='${allUsersValue}']`).innerText\n        document.getElementById('userInfo').innerText = ui   \n    }\n\n    let allAppsValue = document.getElementById(\"allApps\").value\n    if (allAppsValue) {\n        let ai = document.querySelector(`#allAppsDataList>option[value='${allAppsValue}']`).innerText\n        document.getElementById('appInfo').innerText = ai\n    }\n\n    if (allUsersValue && allAppsValue) \n        formListRoleSubmit() \n}\n\n\nfunction filterRows(selector, value ){\n    var v = value.toLowerCase()\n    var rows = document.querySelectorAll(selector)\n    rows.forEach(e => {\n        var txt = e.innerText.toLowerCase()\n        if (txt.indexOf(v) == -1) {\n            e.classList.add(\"hidden\")\n        } else {\n            e.classList.remove(\"hidden\")\n        }\n    });\n}\n\nfunction hideElements(selector) {\n    document.querySelectorAll(selector).forEach(e => e.classList.add(\"hidden\"));\n}\n\n\nfunction showElements(selector) {\n    document.querySelectorAll(selector).forEach(e => e.classList.remove(\"hidden\"));\n}\n\nfunction addClass(selector, classname) {\n        document.querySelectorAll(selector).forEach(e => e.classList.add(classname));\n}\n\nfunction removeClass(selector, classname) {\n    document.querySelectorAll(selector).forEach(e => e.classList.remove(classname));\n}\n\n\nfunction hidePassword() {\n    document.querySelector(\"#formUser input[name='password']\").setAttribute('type','password')\n}\n\nfunction showPassword() {\n    document.querySelector(\"#formUser input[name='password']\").setAttribute('type','text')\n}\n\nfunction removeQueryStringFromBrowserURL() {\n    let url = document.location.href\n    let url1 = url.replace(/\\?.*/, '')\n    let url2 = url1+\"?url=\"+model.appurl\n    history.replaceState(null,null,url2)   \n}\n\nfunction newPassword (n, numbers=false) {\n    let pickSymbol =(s) => s[Math.floor(Math.random()*s.length)]\n    var symbolSets =numbers? [\"0123456789\"]:[\"bcdfghjklmnpqrstvwxz\",\"aeiou\"] \n    var password = ''\n    for (let i=0; i<n; i++){\n        password += pickSymbol(symbolSets[i%symbolSets.length])\n    }\n    return password\n}\n\n\nfunction generatePassword() {\n    document.querySelector(\"#formUser input[name='password']\").value = newPassword(9)\n}\n\nfunction generatePinHash() {\n    let hash = newPassword(20,true);\n    document.querySelector(\"#formUser input[name='pinhash']\").value = hash;\n    setPinUrl();\n}\n\nfunction setPinUrl(){\n    console.debug(\"setPinUrl()\")\n    let input = document.querySelector(\"#formUser input[name='pinhash']\")\n    let hash = input.value\n    hash = hash.replaceAll(\" \",\"\")\n    input.value = hash\n    let url = model.appurl+'/set_authenticator/'+hash\n    let link = document.getElementById('newPinUrl')\n    link.innerText = url\n    link.href = url\n    document.getElementById('pinUrlContainer').style.display= hash? \"block\": \"none\"\n}\n\nfunction buildSocialIcons(url) {\n        fetch(url).then(x => x.json())\n        .then( t => renderOauthProvidersJSON(t) )\n        .catch( err => {\n            console.log(\"fetch error:\",err)\n            return\n            }\n        )  \n}\n\nfunction renderOauthProvidersJSON(jsn) {\n    let el = document.getElementById('socialIcons')\n    \n    if (!el) return\n    \n    el.innerHTML = ''\n    let icons = []\n    for (let [k,v] of Object.entries(jsn) ) {\n        icons.push(`\n        <div class=\"social-element\">\n        <a class=\"button button-clear\" title=\"login via ${k}\" href=\"${model.appurl + v[0]}\">\n        ${k}\n        <br>\n        <img class=\"social-icon\" src=\"images/${k}.svg\">\n        </a>\n        <!--\n        <br>\n        <a class=\"social-logout\" title=\"logout from ${k}\" href=\"${model.appurl + v[1]}\">logout</a>\n        -->\n        </div>\n        \n        \n        `)\n    }\n    \n    \n    if (icons.length > 0){\n        el.innerHTML = '<div class=\"socialHeader\">войти через</div>' + icons.join(' ')\n        showElements(\"#selfRegHelpText\")\n        removeClass('#socialIcons', 'transparent')\n    } else {\n        hideElements(\"#selfRegHelpText\")\n    }\n}\n\n\n\nfunction getNewCaptcha() {\n    let uri = model.appurl+\"/captcha?\"+ new Date().getTime()\n    document.getElementById(\"captchaImg\").src = uri\n    return false\n}\n\n\n// G O O G L E   C H A R T S  ***************************************************************\n\nvar gauges = {}\n\nfunction drawGauge(title, val, maxV, containerID) {\n\n    if (!google) return\n    var container = document.getElementById(containerID)\n    if (! container) return\n\n    if (! gauges[title]) {\n        gauges[title]={}\n        gauges[title].data = google.visualization.arrayToDataTable([['Label', 'Value'], [title, 0]])\n    }\n    if (container.innerHTML == \"\"){\n        gauges[container]=container\n        gauges[title].chart = new google.visualization.Gauge(container)\n        console.log(\"Redraw gauge container:\", containerID)\n    }\n\n    // set values\n    gauges[title].data.setValue(0, 1, val)\n\n    let maxVal = maxV ? maxV: getUpperLimit(val)\n    var options = {\n        // width: 120,\n        height:  120, \n        animation:{\n            duration: 700\n        },\n        greenFrom:0, greenTo: maxVal*0.2,\n        yellowFrom: maxVal*0.8, yellowTo: maxVal*0.9,\n        redFrom: maxVal*0.9, redTo: maxVal,\n        minorTicks: 5,\n        // redColor: '#E10098',\n        // greenColor: 'cyan',\n        max: maxVal\n    }\n\n    // draw the chart\n    gauges[title].chart.draw(gauges[title].data, options)\n}\n\n\nfunction getUpperLimit(n) {\n    var lim = 10\n    while (n > lim) lim *= 10\n    return lim\n}\n\n// **********************************************************************************************\n// **********************************************************************************************\n// **********************************************************************************************\n\n\nfunction clearLoginForm() {\n    document.getElementById(\"loginUsername\").value = \"\"\n    document.getElementById(\"loginPassword\").value = \"\"\n    document.getElementById(\"loginCaptcha\").value = \"\"\n    document.getElementById(\"loginError\").innerText = \"\"\n    document.getElementById(\"socialLoginError\").innerHTML = \"\"\n    document.getElementById(\"oauth2email\").innerHTML = \"\"\n}\n\n\nfunction logout() {\n    logoutGraphQLFormSubmit()\n    clearLoginForm()\n    showPage('login',true)\n    isSelfRegAllowed()\n    model.captchaRequired = false\n    return false\n}\n\n\n// refreshData() если пользователь залогинен наполняет модель данными,\n// в противном случае или обнуляет модель.\nfunction refreshData() {\n    if (model.logined) {\n        getAllApps()\n        getAllUsers()\n        formListAppSubmit()\n        formListUserSubmit()  \n    } else {\n        // nullify model's inner props\n        for (const k of Object.keys(model)) {\n            if (k.startsWith('_')) {\n                model[k] = null\n            }\n        }\n        isSelfRegAllowed()\n   }    \n}\n\nfunction getCurrentPageID(){\n    var p = location.hash.slice(1)\n    return (!p || p.includes('=')) ? 'apps' : p\n}\n\n// refreshApp обновляет данные модели и GUI\nfunction refreshApp() {\n    refreshData()\n    \n    if (model.logined) {\n        let page = getCurrentPageID()\n        showPage(page) \n        showElements('#menu')     \n        hideElements('#menuUnlogined')     \n    } else {\n        showPage('login',true)\n        hideElements('#menu')\n        showElements('#menuUnlogined')\n    }  \n}\n\n\n\nwindow.onhashchange = function(event) {\n    model.debug && console.log(\"onhashchange\", event)\n    var newpage = event.newURL.split('#')[1]\n    if (newpage) \n        showPage(newpage)\n}\n\n\nfunction setAppParams(){\n    model.oauth2email = model.urlParams.get('oauth2email') || ''\n    model.oauth2name = model.urlParams.get('oauth2name') || ''\n    model.oauth2id = model.oauth2email.replace(/@.*/,'')\n    document.getElementById('oauth2email').innerHTML = model.oauth2email\n\n    var url = model.urlParams.get('url')\n    var css = model.urlParams.get('css')\n    var oauth2error = model.urlParams.get('oauth2error')\n    var alrt = model.urlParams.get('alert')\n    if (alrt) alert(alrt)\n    document.getElementById('socialLoginError').innerHTML = oauth2error\n    if (css) \n        document.getElementById('theme').href = css\n    model.appurl = url ? url : 'https://auth-proxy.rg.ru'\n    removeQueryStringFromBrowserURL()\n    //?\n    model.captchaRequired = false\n}\n\n\n"],"names":["delayTimeout","model","debug","oauth2email","oauth2name","oauth2id","priv_origin","appurl","v","this","document","getElementById","innerHTML","buildSocialIcons","href","templatesCache","logined","_loginedUser","urlParams","URLSearchParams","window","location","search","loginedUser","innerText","username","refreshApp","_selfRegAllowed","selfRegAllowed","showElements","hideElements","_captchaRequired","captchaRequired","_authRoles","authRoles","isAdmin","renderTemplateFile","some","e","rolename","_user","user","_app","app","_users","users","_apps","apps","all_app_options","all_user_options","_allApps","allApps","createOptions","querySelector","_allUsers","allUsers","_app_user_roles","app_user_roles","_params","params","_appstat","appstat","sys","alloc","total_alloc","drawGauge","requests_per_day","requests_per_hour","requests_per_minute","requests_per_second","selectValues","keyProp","textProp1","textProp2","output","forEach","value","push","join","highlightTab","tabid","removeClass","addClass","split","showPage","pageid","dontpush","stopGettingAppstat","a","pageid0","id","text","focus","history","state","pushState","getApp","getUser","startGettingAppstat","templateFile","data","targetSelector","cachedTemlpate","renderTemplate","template","rendered","Mustache","render","fetch","then","x","t","delayFunc","f","delay","clearTimeout","setTimeout","searchApps","checked","searchAppsInModel","formListAppSubmit","trim","replace","r","RegExp","found","filter","s","Object","values","test","sortAppsBy","prop","sort","b","appname","searchUsers","searchUsersInModel","formListUserSubmit","sortUsersBy","asStings","doGraphQLRequest","query","responseHandler","errorElementID","method","credentials","body","JSON","stringify","variables","res","ok","json","Error","console","log","errors","message","catch","error","loginGraphQLFormSubmit","event","preventDefault","password","captcha","pin","isPinRequired","getLoginedUser","clearLoginForm","logoutGraphQLFormSubmit","isSelfRegAllowed","is_selfreg_allowed","checkUserRequirements","isCaptchaRequired","is_captcha_required","is_required","getNewCaptcha","is_pin_required","use_pin","pinrequired","resetPassword","alert","generate_password","resetAuthenticator","url","err","result","get_logined_user","getAuthRoles","list_app_user_role","getParams","p","get_params","getAppstatRest","setParams","set_params","counter","undefined","m","clearInterval","statInterval","setInterval","list_user","list","updateUser","old_username","email","fullname","description","disabled","pinhash","pinset","refreshData","createUser","u","get_user","groupApps","gr","aur","arr","key","entries","rec","app_description","items","deleteUser","list_app","createApp","rebase","_public","sign","updateApp","appOperationName","old_appname","get_app","groupUsers","user_fullname","deleteApp","getAllApps","getAllUsers","formListRoleSubmit","modifyRole","action","onsuccess","refreshRoles","allUsersValue","ui","allAppsValue","ai","filterRows","selector","toLowerCase","querySelectorAll","indexOf","classList","add","remove","classname","hidePassword","setAttribute","showPassword","removeQueryStringFromBrowserURL","url2","replaceState","newPassword","n","numbers","pickSymbol","Math","floor","random","length","symbolSets","i","generatePassword","generatePinHash","hash","setPinUrl","input","replaceAll","link","style","display","renderOauthProvidersJSON","jsn","el","icons","k","uri","Date","getTime","src","gauges","title","val","maxV","containerID","google","container","visualization","arrayToDataTable","chart","Gauge","setValue","maxVal","getUpperLimit","options","height","animation","duration","greenFrom","greenTo","yellowFrom","yellowTo","redFrom","redTo","minorTicks","max","draw","lim","logout","keys","startsWith","getCurrentPageID","slice","includes","setAppParams","get","css","oauth2error","alrt","onhashchange","newpage","newURL"],"mappings":"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"}