{"version":3,"file":"bundle.js","sources":["../../src/js/index.js"],"sourcesContent":["// M O D E L  ******************************************************************************************\nvar model = {\n    //---------------------------\n    oauth2email: \"\",\n    oauth2name: \"\",\n    oauth2id: \"\",\n    //---------------------------\n    // url of GraphQL endpoint = appurl + '/graphql'\n    priv_origin: null, \n    set appurl(v){\n        this.priv_origin = v\n        document.getElementById('appUrl').innerHTML = v //'&#x21E2;&nbsp;'+\n        buildSocialIcons(v+\"/oauthproviders\")\n        document.getElementById('graphqlTestLink').href = 'https://graphql-test.vercel.app/?end_point='+v+'/schema&tab_name=auth-proxy'\n    },\n    get appurl(){\n        return this.priv_origin\n    },\n    //---------------------------\n    // templatesCache keeps loaded templates, not to load them repeatedly\n    templatesCache :{},\n\n    //---------------------------\n    get logined(){\n         return (this._loginedUser != null)\n    },\n \n\n    //---------------------------\n    urlParams: new URLSearchParams(window.location.search),\n    //---------------------------\n    _loginedUser: null,\n    set loginedUser(v) {\n        this._loginedUser = v\n        if (v) {\n            document.getElementById(\"userTab\").innerText = '✎ '+v.username\n            // getAuthRoles(model.loginedUser.username)\n        } else {\n            document.getElementById(\"userTab\").innerText = \"\"\n        }\n        refreshApp()\n    },\n    get loginedUser() {\n        return this._loginedUser\n    },\n\n    //---------------------------\n    _selfRegAllowed: false,\n    set selfRegAllowed(v) {\n        this._selfRegAllowed = v\n        if (v) {\n            showElements(\"#selfRegButton\")\n            showElements(\"#selfRegHelp\")\n        } else {\n            hideElements(\"#selfRegButton\")\n            hideElements(\"#selfRegHelp\")\n        }\n    },\n    get selfRegAllowed() {\n        return this._selfRegAllowed\n    },\n    \n    //---------------------------\n    _captchaRequired: false,\n    set captchaRequired(v) {\n        this._captchaRequired = v\n        if (v) {\n            showElements(\"#captcha\")\n        } else {\n            hideElements(\"#captcha\")\n        }\n    },\n    get captchaRequired() {\n        return this._captchaRequired\n    },\n\n    //---------------------------\n    _authRoles: null,\n    set authRoles(v) {\n        this._authRoles = v\n        if (this.isAdmin){\n            showElements('#usersTab')\n            showElements('#rolesTab')\n            showElements('#graphqlTest')\n            showElements('#btnNewApp')\n            showElements('#settingsButton')\n        } else {\n            hideElements('#usersTab')\n            hideElements('#rolesTab')\n            hideElements('#graphqlTest')\n            hideElements('#btnNewApp')\n            hideElements('#settingsButton')\n\n            // showPage('apps')\n        }\n        renderTemplateFile('mustache/apps.html', model, '.app-search-results')\n        \n    },\n    get authRoles() {\n        return this._authRoles\n    },\n    get isAdmin() {\n        if (!model.authRoles) return false\n        return model.authRoles.some(e => (e.rolename == \"authadmin\" || e.rolename == \"auditor\"))\n    },\n    \n    //---------------------------\n    _user: null,\n    set user(v) {\n        this._user = v\n        renderTemplateFile('mustache/user.html', model, '#userPage')\n    },\n    get user() {\n        return this._user\n    },\n    \n    //---------------------------\n    _app: null,\n    set app(v) {\n        this._app = v\n        renderTemplateFile('mustache/app.html', model, '#appPage')\n    },\n    get app() {\n        return this._app\n    },\n    \n    //---------------------------\n    _group: null,\n    set group(v) {\n        this._group = v\n        renderTemplateFile('mustache/group.html', model, '#groupPage')\n    },\n    get group() {\n        return this._group\n    },\n    \n    //---------------------------\n    _users: null,\n    set users(v) {\n        this._users = v\n        renderTemplateFile('mustache/users.html', model, '.user-search-results')\n    },\n    get users() {\n        return this._users\n    },\n    \n    //---------------------------\n    _apps: null,\n    set apps(v) {\n        this._apps = v\n        renderTemplateFile('mustache/apps.html', model, '.app-search-results')\n    },\n    get apps() {\n        return this._apps\n    },\n\n    //---------------------------\n    _groups: null,\n    set groups(v) {\n        this._groups = v\n        renderTemplateFile('mustache/groups.html', model, '.group-search-results')\n    },\n    get groups() {\n        return this._groups\n    },\n\n    //---------------------------\n    all_app_options: null,\n    all_user_options:null,\n    all_group_options:null,\n    \n    //---------------------------\n    _allApps: null,\n    set allApps(v) {\n        this._allApps = v\n        this.all_app_options = createOptions(v, \"appname\", \"description\", \"url\")\n    },\n    get allApps() {\n        return this._allApps\n    },\n\n    //---------------------------\n    _allUsers: null,\n    set allUsers(v) {\n        this._allUsers = v\n        this.all_user_options = createOptions(v, \"username\", \"fullname\", \"email\")\n    },\n    get allUsers() {\n        return this._allUsers\n    },\n\n    //---------------------------\n    _allGroups: null,\n    set allGroups(v) {\n        this._allGroups = v\n        console.debug('allGroups',v)\n        this.all_groups_options = createOptions(v, \"groupname\", \"description\")\n    },\n    get allGroups() {\n        return this._allGroups\n    },\n\n    \n    //---------------------------\n    _app_user_roles: null,\n    set app_user_roles(v) {\n        this._app_user_roles = v\n    },\n    get app_user_roles() {\n        return this._app_user_roles\n    },\n\n    //---------------------------\n    _app_group_roles: null,\n    set app_group_roles(v) {\n        this._app_group_roles = v\n        renderTemplateFile('mustache/app-group-roles.html', model, '.app-group-roles-results')\n    },\n    get app_group_roles() {\n        return this._app_group_roles\n    },\n\n    //---------------------------\n    _user_group_roles: null,\n    set user_group_roles(v) {\n        this._user_group_roles = v\n        renderTemplateFile('mustache/user-group-roles.html', model, '.user-group-roles-results')\n    },\n    get user_group_roles() {\n        return this._user_group_roles\n    },\n\n    //---------------------------\n    _params: null,\n    set params(v) {\n        this._params = v\n        renderTemplateFile('mustache/params.html', model, '#paramsPage')\n        document.getElementById('appName').innerText = v ? v.app_name : '';\n    },\n    get params() {\n        return this._params\n    },\n\n    //---------------------------\n    _appstat: null,\n    set appstat(v) {\n        this._appstat = v\n        if (! document.getElementById('gauges')) return\n\n        document.getElementById('divSys').innerText = v.sys +' Mb'\n        document.getElementById('divAlloc').innerText = 'allocated: '+v.alloc +' Mb'\n        document.getElementById('divTotalAlloc').innerText = 'total allocated: '+v.total_alloc +' Mb'\n\n\n        drawGauge(\"req / day\", v.requests_per_day, 0,  \"divDay\")        // 10000\n        drawGauge(\"req / hour\", v.requests_per_hour, 0, \"divHour\")       // 1000\n        drawGauge(\"req / min\", v.requests_per_minute, 0, \"divMinute\")     // 100\n        drawGauge(\"req / sec\", v.requests_per_second, 0, \"divSecond\")      // 10\n    },\n    get appstat() {\n        return this._appstat\n    },\n\n \n    \n}\n\n\n\n// F U N C T I O N S  *********************************************************************************\n\n// function getListOptionProperty(inputId,propertyName) {\n//     var input = document.getElementById(inputId)\n//     if (!input) return\n//     var value = input.value\n//     var selector = `#${inputId}>option[value='${value}']`\n//     if (!selector) return\n//     var option = document.querySelector(selector)\n//     if (!option) return\n//     var value = option[propertyName]\n//     return value\n// }\n\n// prevent default\nfunction pd(event) {\n    if (event) event.preventDefault()\n}\n\n\nfunction createOptions(selectValues, valueProp, textProp1, textProp2) {\n    var output = []\n    selectValues && selectValues.forEach(function(value)\n    {\n      output.push(`<option id=\"${value.id}\" value=\"${value[valueProp]}\">${value[textProp1]} &nbsp;&nbsp;&nbsp; ${value[textProp2]?value[textProp2]:''}</option>`);\n    })\n    let optionText = output.join('')\n    return optionText\n}\n\n\nfunction highlightTab(tabid) {\n        removeClass('.tab', \"underlined\")\n        var tabid0 = tabid.split(\"/\")[0]\n        addClass('#'+tabid0+'Tab', \"underlined\")   \n}\n\n\nfunction showPage(pageid, dontpush){\n    stopGettingAppstat()\n\n    //распарсить pageidExtended\n    var a = pageid.split(\"/\")\n    var pageName = a[0]\n    var id = a[1]\n\n    highlightTab(pageid)\n    \n    hideElements('.page')\n    showElements('#'+pageName+'Page')\n\n\n    // setting focus\n    var text = document.querySelector('#'+pageName+'Page input[type=\"text\"]')\n    if(text) \n        text.focus()\n\n\n    if (!dontpush){\n        if (!history.state || history.state.pageid != pageid ){\n            history.pushState({pageid:pageid},pageid, \"#\"+pageid) \n        }\n    }\n\n    if (id) {\n        if (pageName == \"app\"){\n            getApp(id)\n        } \n        if (pageName == \"user\"){\n            getUser(id)\n        }\n        if (pageName == \"group\"){\n            getGroup(id)\n        }\n    }\n\n    if (pageName == 'params')\n        startGettingAppstat()\n\n    return false\n}\n\n\nfunction renderTemplateFile(templateFile, data, targetSelector) {\n    // извлекаем шаблон из кэша\n    var cachedTemlpate = model.templatesCache[templateFile]\n    \n    if (cachedTemlpate) {\n        renderTemplate(cachedTemlpate) \n        console.debug(\"from cache:\",templateFile)\n        return\n    }\n    \n    fetch(templateFile).then(x => x.text()).then( template => {\n        // запоминаем шаблон в кэше\n        model.templatesCache[templateFile]=template \n        renderTemplate(template)\n        console.debug(\"loaded template:\",templateFile)\n    })\n\n    return\n\n    function renderTemplate(template) {\n        var rendered = Mustache.render(template, data)\n        document.querySelector(targetSelector).innerHTML = rendered\n    }    \n\n}\n\n\nvar delayTimeout\nfunction delayFunc(f, delay=500) {\n   clearTimeout(delayTimeout) \n   delayTimeout = setTimeout(f, delay)  \n   return false \n}\n\n\nfunction searchApps() {\n    if (document.querySelector('#chkLocalSearch').checked) {\n        return delayFunc(searchAppsInModel, 100)\n    } else {\n        return delayFunc(formListAppSubmit)\n    }\n}\n\nfunction searchAppsInModel() {\n    if (!model.allApps) return\n    var text = document.querySelector(\"#formListApp input[name='search']\").value.trim().replace(' ','.*')\n    var r = new RegExp(text, 'i')\n    let found = model.allApps.filter((v)=>{\n        var s = Object.values(v).join(' ')\n        return r.test(s)\n    })\n    model.apps = found\n    return false   \n}\n\n\nfunction sortAppsBy(prop) {\n    if (!model._allApps) return false\n    model._allApps.sort( (a,b) => (a[prop]+a.appname)>(b[prop]+b.appname)? 1: -1)\n    model._apps.sort( (a,b) => (a[prop]+a.appname)>(b[prop]+b.appname)? 1: -1 )\n    model.apps = model._apps\n    return false\n}\n\n\nfunction searchUsers() {\n    if (document.querySelector('#chkLocalSearch').checked) {\n        return delayFunc(searchUsersInModel, 100)\n    } else {\n        return delayFunc(formListUserSubmit)\n    }\n}\n\n\nfunction searchUsersInModel() {\n    if (!model.allUsers) return\n    var text = document.querySelector(\"#formListUser input[name='search']\").value.trim().replace(' ','.*')\n    var r = new RegExp(text, 'i')\n    let found = model.allUsers.filter( (v) => r.test (Object.values(v).join(' ')) )\n    model.users = found\n    return false   \n}\n\n\nfunction sortUsersBy(prop, asStings = true) {\n    if (!model._allUsers) return false\n    if (asStings){\n        model._allUsers.sort( (a,b) => (a[prop]+a.username)>(b[prop]+b.username)? 1: -1)\n        model._users.sort( (a,b) => (a[prop]+a.username)>(b[prop]+b.username)? 1: -1 )\n    } else {\n        model._allUsers.sort( (a,b) => (a[prop])>(b[prop])? 1: -1)\n        model._users.sort( (a,b) => (a[prop])>(b[prop])? 1: -1 )\n    }\n    model.users = model._users\n    return false\n}\n\nfunction searchGroups() {\n    if (document.querySelector('#chkLocalSearch').checked) {\n        return delayFunc(searchGroupsInModel, 100)\n    } else {\n        return delayFunc(formListGroupSubmit)\n    }\n}\n\n\n\nfunction searchGroupsInModel() {\n    if (!model.allGroups) return\n    var text = document.querySelector(\"#formListGroup input[name='search']\").value.trim().replace(' ','.*')\n    var r = new RegExp(text, 'i')\n    let found = model.allGroups.filter( (v) => r.test (Object.values(v).join(' ')) )\n    model.groups = found\n    return false   \n}\n\n\nfunction sortGroupsBy(prop, asStings = true) {\n    if (!model._allGroups) return false\n    if (asStings){\n        model._allGroups.sort( (a,b) => (a[prop]+a.groupname)>(b[prop]+b.groupname)? 1: -1)\n        model._groups.sort( (a,b) => (a[prop]+a.groupname)>(b[prop]+b.groupname)? 1: -1 )\n    } else {\n        model._allGroups.sort( (a,b) => (a[prop])>(b[prop])? 1: -1)\n        model._groups.sort( (a,b) => (a[prop])>(b[prop])? 1: -1 )\n    }\n    model.groups = model._groups\n    return false\n}\n\n\nfunction errorMessage(errorElementID, errMsg) {\n    console.debug(errMsg)\n    if (errorElementID) {\n        document.getElementById(errorElementID).innerText = errMsg\n    }\n}\n\n// R E Q U E S T S  *******************************************************\n\nfunction doGraphQLRequest(query, responseHandler, errorElementID=\"loginError\") {\n    fetch(model.appurl+'/graphql', { \n        // headers: new Headers({cache: \"no-cache\"}),\n        method: 'POST', \n        credentials: 'include', \n        body: JSON.stringify({ query: query, variables: {} }) \n    })\n        .then(res => { \n            if (res.ok) {\n                return res.json();\n            }\n            new Error(res)\n        })\n        .then((res) => {\n            console.debug(\"doGraphQLRequest() result=\",res)\n            if (res.errors){\n                let errMsg = res.errors[0].message\n                errorMessage(errorElementID, errMsg)\n                return\n            }\n            responseHandler && responseHandler(res)\n        })\n        .catch( e =>  errorMessage(errorElementID, \"doGraphQLRequest: \" +e ))    \n    \n}\n\n\n// L O G I N  *****************************************************************************\n\nfunction loginGraphQLFormSubmit(event) {\n    if (event) event.preventDefault()\n    \n    let username = document.getElementById(\"loginUsername\").value\n    let password = document.getElementById(\"loginPassword\").value\n    let captcha =  document.getElementById(\"loginCaptcha\").value\n    let pin =  document.getElementById(\"loginPin\").value\n    if (username == \"\") {\n        errorMessage(\"loginError\", 'Заполните поле email')\n        return\n    }\n\n    isPinRequired(username)\n    \n\n    let query =`\n    query {\n        login(\n        username: \"${username}\",\n        password: \"${password}\",\n        captcha: \"${captcha}\",\n        pin: \"${pin}\"\n        )\n        }    \n    `\n    function onSuccess(res){\n        getLoginedUser()\n    }   \n    \n    doGraphQLRequest(query, onSuccess, \"loginError\")\n    clearLoginForm()\n    return false       \n}\n\n\n\nfunction logoutGraphQLFormSubmit(event) {\n    if (event) event.preventDefault()\n    var query =`\n    query {\n        logout {\n            message\n            email\n          }\n        }\n    `\n\n    function onSuccess(res){\n        model.loginedUser = null\n        model.oauth2email =\"\"\n        model.oauth2id =\"\"\n        model.oauth2name =\"\"\n\n        refreshApp()\n    }\n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\n\nfunction isSelfRegAllowed(event) {\n    if (event) event.preventDefault()\n    var query =` query { is_selfreg_allowed }`\n\n    function onSuccess(res){\n        model.selfRegAllowed = res.data.is_selfreg_allowed\n    }\n       \n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction checkUserRequirements(event) {\n    if (event) event.preventDefault()\n    let username = document.getElementById(\"loginUsername\").value   \n    isCaptchaRequired(username)\n    isPinRequired(username)\n    return false \n}\n\n\nfunction isCaptchaRequired(username) {\n    var query =`  query { is_captcha_required(  username: \"${username}\" ) \n        {\n            is_required \n            path\n        } \n    } `\n\n    function onSuccess(res){\n        model.captchaRequired = res.data.is_captcha_required.is_required\n        if (model.captchaRequired) {\n            getNewCaptcha()\n            console.debug(\"Captcha IS required\")\n        }\n    }\n       \n    doGraphQLRequest(query, onSuccess)   \n}\n\n\nfunction isPinRequired(username) {\n    errorMessage(\"loginError\", \"\")\n    \n    var query =`  query { is_pin_required(  username: \"${username}\" ) \n        {\n            use_pin \n            pinrequired\n        } \n    } `\n\n    function onSuccess(res){\n        let r = res.data.is_pin_required;\n        console.debug(\"isPinRequired()->\", r);\n        (r.use_pin && r.pinrequired) ? showElements(\".pinclass\") : hideElements(\".pinclass\"); \n    }\n       \n    doGraphQLRequest(query, onSuccess)   \n}\n\n\n\nfunction resetPasswordRest(event) {\n    if (event) event.preventDefault()\n    errorMessage(\"resetError\", \"\")\n    let username = document.getElementById(\"loginUsername\").value\n    if (!username) {\n        errorMessage(\"resetError\", 'Заполните поле email')\n        return false\n    }\n    let adminurl = location.origin + location.pathname\n    let url = `${model.priv_origin}/reset_password?username=${username}&adminurl=${adminurl}&authurl=${model.priv_origin}`\n    fetch(url).then( r => r.json()).then(onSuccess).catch(onError)\n    \n    function onSuccess(res){\n        errorMessage(\"resetError\", res.error)\n        if (res.result) {\n             alert(res.result)\n        } \n    }\n\n    function onError(err){\n        errorMessage(\"resetError\", \"resetPasswordRest \" + err)\n    }\n\n    return false \n}\n\n\n\nfunction resetAuthenticator(event) {\n    if (event) event.preventDefault()\n    errorMessage(\"resetError\", \"\")\n    let username = document.getElementById(\"loginUsername\").value\n    if (!username) {\n        errorMessage(\"resetError\", 'Заполните поле email')\n        return false\n    }\n    let adminurl = location.origin + location.pathname\n    let url = `${model.priv_origin}/reset_authenticator?username=${username}&adminurl=${adminurl}&authurl=${model.priv_origin}`\n    fetch(url).then( r => r.json()).then(onSuccess).catch(onError)\n    \n    function onSuccess(res){\n        errorMessage(\"resetError\", res.error)\n        if (res.result) {\n             alert(res.result)\n        } \n    }\n\n    function onError(err){\n        errorMessage(\"resetError\", \"resetAuthenticator \"+err)\n    }\n\n    return false \n}\n\n\n\n// L O G I N E D   U S E R   **********************************************************************************************************************\n\n\nfunction getLoginedUser() {\n    model.loginedUser = null\n    var query =`\n    query {\n        get_logined_user {\n            description\n            email\n            fullname\n            username\n            disabled\n            id\n            pinhash\n            pinrequired\n            pinhash_temp  \n            emailhash\n            emailconfirmed    \n        }\n    }\n    `\n    \n    function onSuccess(res){\n        model.loginedUser = res.data.get_logined_user\n        getAuthRoles(model.loginedUser.username)\n        getUser(model.loginedUser.username)\n    } \n    \n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction getAuthRoles(username) {\n    model.authRoles = null\n\n    var query =`\n    query {\n        list_app_user_role(\n            appname: \"auth\",\n            username: \"${username}\"\n            ) {\n                rolename\n            }\n        }\n        `\n\n    function onSuccess(res){\n        model.authRoles = res.data.list_app_user_role\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n// P A R A M S  ***********************************************************************************************************************\n\n\nfunction getParams() {\n    model.params = null\n    var query =`\n    query {\n        get_params {\n            app_name\n            max_attempts\n            reset_time\n            selfreg\n            use_captcha\n            use_pin\n          }\n        }\n    `\n\n    function onSuccess(res){\n        var p = res.data.get_params\n        model.params = p\n        getAppstatRest()\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\nfunction setParams(event) {\n    if (event) event.preventDefault()\n    let selfreg =       document.querySelector(\"#formParams input[name='selfreg']\").checked\n    let use_captcha =   document.querySelector(\"#formParams input[name='use_captcha']\").checked\n    let use_pin =       document.querySelector(\"#formParams input[name='use_pin']\").checked\n    let max_attempts =  document.querySelector(\"#formParams input[name='max_attempts']\").value\n    let reset_time =    document.querySelector(\"#formParams input[name='reset_time']\").value\n    \n    var query =`\n    query {\n        set_params(\n        selfreg:      ${selfreg},\n        use_captcha:  ${use_captcha},\n        use_pin:      ${use_pin},\n        max_attempts: ${max_attempts},\n        reset_time:   ${reset_time}\n        ) {\n            max_attempts\n            reset_time\n            selfreg\n            use_captcha\n            use_pin\n          }\n        }\n    `\n\n    function onSuccess(res){\n        model.params = res.data.set_params\n        alert(\"params saving success\")\n    }\n\n    doGraphQLRequest(query, onSuccess, \"paramsError\")\n    return false       \n}\n\n\n// function getAppstat(event) {\n//     if (event) event.preventDefault()\n//     var query =`\n//     query {\n//         get_stat {\n//             alloc\n//             requests_per_day\n//             requests_per_hour\n//             requests_per_minute\n//             requests_per_second\n//             sys\n//             total_alloc\n//           }\n//         }\n//     `\n\n//     function onSuccess(res){\n//         var m = res.data.get_stat\n//         model.appstat = m\n//     } \n\n//     doGraphQLRequest(query, onSuccess, \"appstatError\")\n//     return false       \n// }\n\nfunction getAppstatRest(event) {\n    if (event) event.preventDefault()\n    getAppstatRest.counter = getAppstatRest.counter === undefined ? 0: getAppstatRest.counter+1\n    console.log(\"getAppstatRest.counter = \",getAppstatRest.counter)\n\n\n    fetch(model.appurl + \"/stat\").then(x => x.json())\n    .then( onSuccess )\n    .catch( err => {\n        console.log(\"fetch error:\",err)\n        return\n        }\n    )  \n\n    function onSuccess(res){\n        var m = res\n        model.appstat = m\n    } \n    return false       \n}\n\nmodel.statInterval = null\nfunction startGettingAppstat(){\n    clearInterval(model.statInterval)\n    getAppstatRest()\n    model.statInterval = setInterval(getAppstatRest, 3000)\n    console.log('startGettingAppstat')\n}\n\nfunction stopGettingAppstat(){\n    clearInterval(model.statInterval)\n    // console.log('stopGettingAppstat')\n}\n\n// U S E R S  ***********************************************************************************************************************\n\n\nfunction formListUserSubmit(event) {\n    if (event) event.preventDefault()\n    model.users = null\n    let search = document.querySelector(\"#formListUser input[name='search']\").value\n    \n    var query =`\n    query {\n        list_user(\n        search: \"${search}\",\n        order: \"fullname ASC\"\n        ) {\n            length\n            list {\n              description\n              email\n              fullname\n              username\n              disabled\n              id\n              pinhash\n              pinrequired\n              pinhash_temp   \n              emailhash\n              emailconfirmed    \n              }\n          }\n        }        \n    `\n    \n    function onSuccess(res){\n        model.users = res.data.list_user.list\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\n\n\nfunction updateUser(event) {\n    if (event) event.preventDefault()\n    let id =  document.querySelector(\"#user-id\").innerText\n    // let old_username =  document.querySelector(\"#formUser input[name='old_username']\").value\n    // let username =      document.querySelector(\"#formUser input[name='username']\").value\n    let password =      document.querySelector(\"#formUser input[name='password']\").value\n    // let email    =      document.querySelector(\"#formUser input[name='email']\").value\n    let fullname =      document.querySelector(\"#formUser input[name='fullname']\").value\n    let description =   document.querySelector(\"#formUser *[name='description']\").value\n    let disabled =      document.querySelector(\"#formUser input[name='disabled']\").value\n    let pinrequired =   document.querySelector(\"#formUser input[name='pinrequired']\").checked\n    \n    var query =`\n    mutation {\n        update_user(\n        id: ${id}\n        password: \"${password}\",\n        fullname: \"${fullname}\",\n        description: \"${description}\",\n        disabled: ${disabled},\n        pinrequired: ${pinrequired}\n        ) {\n            description\n            email\n            fullname\n            username\n            disabled\n            id\n            pinhash\n            pinrequired\n            pinhash_temp      \n            emailhash\n            emailconfirmed    \n          }\n\n        }\n    `\n\n    function onSuccess(res){\n        alert(\"update_user success\")\n        refreshData()\n        model.user = res.data[\"update_user\"]\n        getUser(model.user.username)\n    }\n\n    doGraphQLRequest(query, onSuccess, \"userError\")\n    return false       \n}\n\n\nfunction createUser(event) {\n    if (event) event.preventDefault()\n    // let username =      document.querySelector(\"#formUser input[name='username']\").value\n    let email    =      document.querySelector(\"#formUser input[name='email']\").value\n    let password =      document.querySelector(\"#formUser input[name='password']\").value\n    let fullname =      document.querySelector(\"#formUser input[name='fullname']\").value\n    let description =   document.querySelector(\"#formUser *[name='description']\").value\n    let disabled =      document.querySelector(\"#formUser input[name='disabled']\").value\n    let pinrequired =   document.querySelector(\"#formUser input[name='pinrequired']\").checked\n    \n    var query =`\n    mutation {\n        create_user(\n        email: \"${email}\",\n        password: \"${password}\",\n        fullname: \"${fullname}\",\n        description: \"${description}\",\n        disabled: ${disabled},        \n        pinrequired: ${pinrequired},\n        ) {\n            description\n            email\n            fullname\n            username\n            disabled\n            id\n            pinhash\n            pinrequired \n            pinhash_temp       \n            emailhash\n            emailconfirmed    \n          }\n\n        }\n    `\n\n    function onSuccess(res){\n        alert(\"create_user success\")\n        refreshData()\n        model.user = res.data[\"create_user\"]\n        if (!model.logined) {\n            alert(`\"${model.user.username}\" is created.` )\n            showPage('login',true)\n        } else {\n            getUser(model.user.username)\n        }\n    }\n\n    doGraphQLRequest(query, onSuccess, \"userError\")\n    return false       \n}\n\n\nfunction getUser(username) {\n    model.user = null\n    var query =`\n    query {\n        get_user(\n        username: \"${username}\"\n        ) {\n            description\n            email\n            fullname\n            username\n            disabled\n            id\n            pinhash\n            pinrequired\n            pinhash_temp     \n            emailhash\n            emailconfirmed    \n          }\n        \n        list_app_user_role(\n        username: \"${username}\"\n        ) {\n            app_description\n            appname\n            rolename\n            username\n          }\n    }\n    `\n\n    function onSuccess(res){\n        var u = res.data.get_user\n        u.apps = appsOfTheUser(res.data.list_app_user_role)\n        // render \n        model.user = u\n        fetchGroupsOfTheUser(u.id)\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\n\nfunction appsOfTheUser(list_app_user_role) {\n    if (!list_app_user_role) return []\n    \n    let gr = {}\n    for (let aur of list_app_user_role ){\n        if (!gr[aur.appname]) gr[aur.appname] =[]\n        gr[aur.appname].push(aur)\n    }\n\n    let arr = []\n\n    for (let [key, value] of Object.entries(gr)) {\n        let rec = {}\n        rec.appname =key\n        rec.app_description = value[0].app_description\n        rec.items = value\n        arr.push(rec)\n    }\n    return arr\n}\n\n\n\nfunction deleteUser(username) {\n    var query =`\n    mutation {\n        delete_user(\n        username: \"${username}\"\n        ) {\n            username\n          }\n        }\n    `\n    function onSuccess(res){\n        model.user = null\n        refreshData()\n        showPage('users')\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\nfunction fetchGroupsOfTheUser(user_id) {\n    var query =`\n    query {\n        list_group_user_role(\n        user_id: ${user_id}\n        ) {\n            group_description\n            group_groupname\n            group_id\n            rolename\n            user_description\n            user_disabled\n            user_email\n            user_fullname\n            user_id\n            }        \n        }\n    `\n\n    function onSuccess(res){\n        var u = model.user\n        u.groups = groupsOfTheUser(res.data.list_group_user_role)\n        // render \n        model.user = u\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction groupsOfTheUser(list_group_user_role) {\n    let groups = groupByField(list_group_user_role, 'group_id')\n\n    // преобразуем хэш в массив для отображения в mustache\n    let arr = []\n\n    for (let [key, value] of Object.entries(groups)) {\n        let rec = {}\n        rec.group_id =key\n        rec.user_id = value[0].user_id\n        rec.user_email = value[0].user_email\n        rec.group_groupname = value[0].group_groupname\n        rec.group_description = value[0].group_description\n        rec.items = value\n        arr.push(rec)\n    }\n    return arr\n}\n\n\n\n// A P P S  *******************************************************************\n\nfunction formListAppSubmit(event) {\n    if (event) event.preventDefault()\n    model.apps = null\n    let search = document.querySelector(\"#formListApp input[name='search']\").value\n    var query =`\n    query {\n        list_app(\n        search: \"${search}\",\n        order: \"description ASC\"\n        ) {\n            length\n            list {\n              appname\n              description\n              url\n              rebase\n              public\n              sign\n            }\n          }\n        }    `\n\n    function onSuccess(res){\n        model.apps = res.data.list_app.list\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\n\nfunction createApp(event) {\n    if (event) event.preventDefault()\n    let appname =     document.querySelector(\"#formApp input[name='appname']\"    ).value\n    let url =         document.querySelector(\"#formApp input[name='url']\"        ).value\n    let description = document.querySelector(\"#formApp input[name='description']\").value\n    let rebase =      document.querySelector(\"#formApp input[name='rebase']\"     ).value\n    let _public =     document.querySelector(\"#formApp input[name='public']\"     ).value\n    let sign =        document.querySelector(\"#formApp input[name='sign']\"       ).value\n    \n    var query =`\n    mutation {\n        create_app(\n        appname: \"${appname}\",\n        url: \"${url}\",\n        description: \"${description}\",\n        rebase: \"${rebase}\",\n        public: \"${_public}\",\n        sign: \"${sign}\"\n        ) {\n            description\n            appname\n            url\n            rebase\n            public\n            sign\n          }\n\n        }\n    `\n    function onSuccess(res){\n        alert(\"create_app success\")\n        refreshData()\n        model.app = res.data[\"create_app\"]\n        getApp(appname)\n    } \n\n    doGraphQLRequest(query, onSuccess, \"appError\")\n    return false       \n}\n\n\nfunction updateApp(event, appOperationName = 'create_app') {\n    if (event) event.preventDefault()\n    let old_appname = document.querySelector(\"#formApp input[name='old_appname']\"    ).value\n    let appname =     document.querySelector(\"#formApp input[name='appname']\"    ).value\n    let url =         document.querySelector(\"#formApp input[name='url']\"        ).value\n    let description = document.querySelector(\"#formApp input[name='description']\").value\n    let rebase =      document.querySelector(\"#formApp input[name='rebase']\"     ).value\n    let _public =     document.querySelector(\"#formApp input[name='public']\"     ).value\n    let sign =        document.querySelector(\"#formApp input[name='sign']\"       ).value\n    \n    var query =`\n    mutation {\n        update_app(\n        old_appname: \"${old_appname}\",\n        appname: \"${appname}\",\n        url: \"${url}\",\n        description: \"${description}\",\n        rebase: \"${rebase}\",\n        public: \"${_public}\",\n        sign: \"${sign}\"\n        ) {\n            description\n            appname\n            url\n            rebase\n            public\n            sign\n          }\n\n        }\n    `\n    function onSuccess(res){\n        alert(\"update_app success\")\n        refreshData()\n        model.app = res.data[\"update_app\"]\n        getApp(appname)\n    } \n\n    doGraphQLRequest(query, onSuccess, \"appError\")\n    return false       \n}\n\n\n\nfunction getApp(appname) {\n    model.app = null\n\n    var query =`\n    query {\n        get_app(\n        appname: \"${appname}\"\n        ) {\n            appname\n            description\n            id\n            public\n            rebase\n            sign\n            url\n          }\n        \n        list_app_user_role(\n        appname: \"${appname}\"\n        ) {\n            appname\n            rolename\n            user_fullname\n            user_disabled\n            username\n          }\n        \n        }\n\n    `\n\n    function onSuccess(res){\n        var a = res.data.get_app\n        a.users = usersOfTheApp(res.data.list_app_user_role)\n        // render\n        model.app = a\n        fetchGroupsOfTheApp(a.id)\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction usersOfTheApp(list_app_user_role) {\n    let gr = {}\n    for (let aur of list_app_user_role ){\n        if (!gr[aur.username]) gr[aur.username] =[]\n        gr[aur.username].push(aur)\n    }\n\n    let arr = []\n\n    for (let [key, value] of Object.entries(gr)) {\n        let rec = {}\n        rec.username =key\n        rec.user_fullname = value[0].user_fullname\n        rec.items = value\n        arr.push(rec)\n    }\n    return arr\n}\n\n\nfunction deleteApp(appname) {\n    var query =`\n    mutation {\n        delete_app(\n        appname: \"${appname}\"\n        ) {\n            appname\n          }\n        }\n    `\n    function onSuccess(res){\n        model.app = null\n        refreshData()\n        showPage('apps') ;\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction fetchGroupsOfTheApp(app_id) {\n    var query =`\n    query {\n        list_group_app_role(\n        app_id: ${app_id}\n        ) {\n            app_appname\n            app_description\n            app_id\n            app_url\n            group_description\n            group_groupname\n            group_id\n            rolename\n            }        \n        }\n    `\n\n    function onSuccess(res){\n        var a = model.app\n        a.groups = groupsOfTheApp(res.data.list_group_app_role)\n        // render \n        model.app = a\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction groupsOfTheApp(list_group_app_role) {\n    let groups = groupByField(list_group_app_role, 'group_id')\n\n    // преобразуем хэш в массив для отображения в mustache\n    let arr = []\n\n    for (let [key, value] of Object.entries(groups)) {\n        let rec = {}\n        rec.group_id =key\n        rec.app_id = value[0].app_id\n        rec.app_name = value[0].app_appname\n        rec.group_groupname = value[0].group_groupname\n        rec.group_description = value[0].group_description\n        rec.items = value\n        arr.push(rec)\n    }\n    return arr\n}\n\n\n\n\n// G R O U P S   *******************************************************************\n\nfunction formListGroupSubmit(event) {\n    if (event) event.preventDefault()\n    model.groups = null\n    let search = document.querySelector(\"#formListGroup input[name='search']\").value\n    var query =`\n    query {\n        list_group(\n        search: \"${search}\",\n        order: \"description ASC\"\n        ) {\n            length\n            list {\n              description\n              groupname\n              id\n           }\n          }\n        }    `\n\n    function onSuccess(res){\n        model.groups = res.data.list_group.list\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\n\nfunction createGroup(event) {\n    if (event) event.preventDefault()\n    let groupname =     document.querySelector(\"#formGroup input[name='groupname']\").value\n    let description = document.querySelector(\"#formGroup input[name='description']\").value\n    \n    var query =`\n    mutation {\n        create_group(\n        groupname: \"${groupname}\",\n        description: \"${description}\"\n        ) {\n            description\n            groupname\n            id\n          }\n\n        }\n    `\n    function onSuccess(res){\n        alert(\"create_group success\")\n        refreshData()\n        model.group = res.data[\"create_group\"]\n        getGroup(model.group.id)\n    } \n\n    doGraphQLRequest(query, onSuccess, \"groupError\")\n    return false       \n}\n\n\nfunction updateGroup(event) {\n    if (event) event.preventDefault()\n    let groupname =     document.querySelector(\"#formGroup input[name='groupname']\"    ).value\n    let description = document.querySelector(\"#formGroup input[name='description']\").value\n    let id =      document.querySelector(\"#formGroup input[name='id']\"     ).value\n   \n    var query =`\n    mutation {\n        update_group(\n        id: ${id},\n        groupname: \"${groupname}\",\n        description: \"${description}\"\n        ) {\n            description\n            groupname\n            id\n          }\n\n        }\n    `\n    function onSuccess(res){\n        alert(\"update_group success\")\n        refreshData()\n        model.group = res.data[\"update_group\"]\n        getGroup(id)\n    } \n\n    doGraphQLRequest(query, onSuccess, \"groupError\")\n    return false       \n}\n\n\n\nfunction getGroup(group_id) {\n    model.group = null\n\n    var query =`\n    query {\n        get_group(\n        id: ${group_id}\n        ) {\n            description\n            groupname\n            id\n          }\n\n        list_group_app_role(\n        group_id:${group_id}\n        ) {\n            app_appname\n            app_description\n            app_id\n            app_url\n            group_description\n            group_groupname\n            group_id\n            rolename\n           }          \n                \n        }\n\n    `\n\n    // list_group_user_role(\n    //     group_id: ${group_id}\n    //     ) {\n    //         group_description\n    //         group_groupname\n    //         group_id\n    //         rolename\n    //         user_description\n    //         user_disabled\n    //         user_email\n    //         user_fullname\n    //         user_id\n    //       }\n\n\n\n    function onSuccess(res){\n        var group = res.data.get_group\n        group.apps = appsOfTheGroup(res.data.list_group_app_role)\n        // render\n        model.group = group\n    } \n\n    doGraphQLRequest(query, onSuccess, \"groupError\")\n    return false       \n}\n\n// Group array of records by fieldName.\n// Returns a map fieldName->array of records\nfunction groupByField(records, fieldName){\n    let values = {}\n    for (let rec of records ){\n        let val = rec[fieldName]\n        if (!values[val]) {\n            values[val] =[]\n        }\n        values[val].push(rec)\n    }\n    return values\n}\n\n\nfunction appsOfTheGroup(list_group_app_role) {\n    let apps = groupByField(list_group_app_role, 'app_id')\n\n    // преобразуем хэш в массив для отображения в mustache\n    let arr = []\n\n    for (let [key, value] of Object.entries(apps)) {\n        let rec = {}\n        rec.app_id =key\n        rec.group_id = value[0].group_id\n        rec.app_appname = value[0].app_appname\n        rec.app_description = value[0].app_description\n        rec.app_url = value[0].app_url\n        rec.items = value\n        arr.push(rec)\n    }\n    return arr\n}\n\n\n\nfunction deleteGroup(id) {\n    var query =`\n    mutation {\n        delete_group(\n        id: ${id}\n        ) {\n            description\n          }\n        }\n    `\n    function onSuccess(res){\n        alert(\"delete_group success\")\n        model.group = null\n        refreshData()\n        searchGroups(); \n        showPage('groups') ;\n    } \n\n    doGraphQLRequest(query, onSuccess, \"groupError\")\n    return false       \n}\n\n\n\n\n// A P P   U S E R   R O L E   **************************************************************************************************\n\nfunction getAllApps(event) {\n    if (event) event.preventDefault()\n    model.allApps = null\n    var query =`\n    query {\n        list_app(\n        order: \"appname ASC\"\n        ) {\n            length\n            list {\n              id\n              appname\n              description\n              url\n              rebase\n              public \n              sign\n            }\n          }\n        }    `\n\n    function onSuccess(res){\n        model.allApps = res.data.list_app.list\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction getAllUsers(event) {\n    if (event) event.preventDefault()\n    model.allUsers = null\n    var query =`\n    query {\n        list_user(\n        order: \"fullname ASC\"\n        ) {\n            length\n            list {\n              username\n              fullname\n              email\n              description\n              disabled\n              id\n              pinhash\n              pinrequired\n              pinhash_temp    \n              emailhash\n              emailconfirmed      \n              }\n          }\n        }    `\n\n    function onSuccess(res){\n        model.allUsers = res.data.list_user.list\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction getAllGroups(event) {\n    if (event) event.preventDefault()\n    model.allGroups = null\n    var query =`\n    query {\n        list_group(\n        order: \"groupname ASC\"\n        ) {\n            length\n            list {\n              groupname\n              description\n              id\n            }\n          }\n        }    `\n\n    function onSuccess(res){\n        model.allGroups = res.data.list_group.list\n    } \n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction modifyRole(action,appname,username,rolename, onsuccess ) {\n    if (!appname || !username || !rolename) return\n\n    var query =`\n    mutation {\n        ${action}_app_user_role(\n        appname: \"${appname}\",\n        username: \"${username}\",\n        rolename: \"${rolename}\"\n        ) {\n            rolename\n            appname\n            username\n          }\n        }\n    `\n    function onSuccess(res){\n        if (onsuccess) onsuccess()\n    }\n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\nfunction modifyGroupAppRole(action,group_id,app_id,rolename, onsuccess ) {\n    if (!group_id || !app_id || !rolename) \n        return\n    var query =`\n    mutation {\n        ${action}_group_app_role(\n        group_id: ${group_id},\n        app_id: ${app_id},\n        rolename: \"${rolename}\"\n        ) {\n            app_appname\n            app_description\n            app_id\n            app_url\n            group_description\n            group_groupname\n            group_id\n            rolename\n          }\n        }\n    `\n    function onSuccess(res){\n        if (onsuccess) onsuccess()\n    }\n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\nfunction modifyUserGroupRole(action,user_id,group_id,rolename, onsuccess ) {\n    if (!user_id || !group_id || !rolename) \n        return\n    var query =`\n    mutation {\n        ${action}_group_user_role(\n        user_id: ${user_id},\n        group_id: ${group_id},\n        rolename: \"${rolename}\"\n        ) {\n            group_description\n            group_groupname\n            group_id\n            rolename\n            user_description\n            user_disabled\n            user_email\n            user_fullname\n            user_id\n           }\n    }\n    `\n    function onSuccess(res){\n        if (onsuccess) onsuccess()\n    }\n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\nfunction modifyAppGroupRole(action,app_id,group_id,rolename, onsuccess ) {\n    if (!app_id || !group_id || !rolename) \n        return\n    var query =`\n    mutation {\n        ${action}_group_app_role(\n        app_id: ${app_id},\n        group_id: ${group_id},\n        rolename: \"${rolename}\"\n        ) {\n            app_appname\n            app_description\n            app_id\n            app_url\n            group_description\n            group_groupname\n            group_id\n            rolename\n          }\n    }\n    `\n    function onSuccess(res){\n        if (onsuccess) onsuccess()\n    }\n\n    doGraphQLRequest(query, onSuccess)\n    return false       \n}\n\n\nfunction filterRows(selector, value ){\n    var v = value.toLowerCase()\n    var rows = document.querySelectorAll(selector)\n    rows.forEach(e => {\n        var txt = e.innerText.toLowerCase()\n        if (txt.indexOf(v) == -1) {\n            e.classList.add(\"hidden\")\n        } else {\n            e.classList.remove(\"hidden\")\n        }\n    });\n}\n\nfunction toggleElements(selector) {\n    document.querySelectorAll(selector).forEach(e => e.classList.toggle(\"hidden\"));\n}\n\nfunction hideElements(selector) {\n    document.querySelectorAll(selector).forEach(e => e.classList.add(\"hidden\"));\n}\n\n\nfunction showElements(selector) {\n    document.querySelectorAll(selector).forEach(e => e.classList.remove(\"hidden\"));\n}\n\nfunction addClass(selector, classname) {\n        document.querySelectorAll(selector).forEach(e => e.classList.add(classname));\n}\n\nfunction removeClass(selector, classname) {\n    document.querySelectorAll(selector).forEach(e => e.classList.remove(classname));\n}\n\n\nfunction hidePassword() {\n    document.querySelector(\"#formUser input[name='password']\").setAttribute('type','password')\n}\n\nfunction showPassword() {\n    document.querySelector(\"#formUser input[name='password']\").setAttribute('type','text')\n}\n\nfunction removeQueryStringFromBrowserURL() {\n    let url = document.location.href\n    let url1 = url.replace(/\\?.*/, '')\n    let url2 = url1+\"?url=\"+model.appurl\n    history.replaceState(null,null,url2)   \n}\n\nfunction newPassword (n, numbers=false) {\n    let pickSymbol =(s) => s[Math.floor(Math.random()*s.length)]\n    var symbolSets =numbers? [\"0123456789\"]:[\"bcdfghjklmnpqrstvwxz\",\"aeiou\"] \n    var password = ''\n    for (let i=0; i<n; i++){\n        password += pickSymbol(symbolSets[i%symbolSets.length])\n    }\n    return password\n}\n\n\nfunction generatePassword() {\n    document.querySelector(\"#formUser input[name='password']\").value = newPassword(9)\n}\n\nfunction generatePinHash() {\n    let hash = (window.crypto && window.crypto.randomUUID) ? window.crypto.randomUUID() : newPassword(20,true);\n    document.querySelector(\"#formUser input[name='pinhash_temp']\").value = hash;\n    setPinUrl();\n}\n\nfunction setPinUrl(){\n    let input = document.querySelector(\"#formUser input[name='pinhash_temp']\")\n    let hash = input.value\n    hash = hash.replaceAll(\" \",\"\")\n    input.value = hash\n    // let url = `/set-authenticator.html#username=${model.user.username}&hash=${model.user.pinhash_temp}&authurl=${model.appurl}`\n    // let link = document.getElementById('newPinUrl')\n    // link.innerText = url\n    // link.href = url\n    document.getElementById('pinUrlContainer').style.display= \"none\"\n}\n\nfunction buildSocialIcons(url) {\n        fetch(url).then(x => x.json())\n        .then( t => renderOauthProvidersJSON(t) )\n        .catch( err => {\n            console.log(\"fetch error:\",err)\n            return\n            }\n        )  \n}\n\nfunction renderOauthProvidersJSON(jsn) {\n    let el = document.getElementById('socialIcons')\n    \n    if (!el) return\n    \n    el.innerHTML = ''\n    let icons = []\n    for (let [k,v] of Object.entries(jsn) ) {\n        icons.push(`\n        <div class=\"social-element\">\n        <a class=\"button button-clear\" title=\"login via ${k}\" href=\"${model.appurl + v[0]}\">\n        ${k}\n        <br>\n        <img class=\"social-icon\" src=\"images/${k}.svg\">\n        </a>\n        <!--\n        <br>\n        <a class=\"social-logout\" title=\"logout from ${k}\" href=\"${model.appurl + v[1]}\">logout</a>\n        -->\n        </div>\n        \n        \n        `)\n    }\n    \n    \n    if (icons.length > 0){\n        el.innerHTML = '<div class=\"socialHeader\">войти через социальную сеть</div>' + icons.join(' ')\n        showElements(\"#selfRegHelpText\")\n        removeClass('#socialIcons', 'transparent')\n    } else {\n        hideElements(\"#selfRegHelpText\")\n    }\n}\n\n\n\nfunction getNewCaptcha() {\n    let uri = model.appurl+\"/captcha?\"+ new Date().getTime()\n    document.getElementById(\"captchaImg\").src = uri\n    return false\n}\n\n\n// G O O G L E   C H A R T S  ***************************************************************\n\n// google.charts.load('current', {packages: ['gauge']})\n// google.charts.setOnLoadCallback(drawGauge)\n\n\nvar gauges = {}\n\nfunction drawGauge(title, val, maxV, containerID) {\n\n    if (!google) return\n    if (!google.visualization) return\n    if (!google.visualization.arrayToDataTable) return\n    if (!google.visualization.Gauge) return\n    \n    var container = document.getElementById(containerID)\n    if (! container) return\n\n    if (! gauges[title]) {\n        gauges[title]={}\n        gauges[title].data = google.visualization.arrayToDataTable([['Label', 'Value'], [title, 0]])\n    }\n    if (container.innerHTML == \"\"){\n        gauges[container]=container\n        gauges[title].chart = new google.visualization.Gauge(container)\n        console.log(\"Redraw gauge container:\", containerID)\n    }\n\n    // set values\n    gauges[title].data.setValue(0, 1, val)\n\n    let maxVal = maxV ? maxV: getUpperLimit(val)\n    var options = {\n        // width: 120,\n        height:  120, \n        animation:{\n            duration: 700\n        },\n        greenFrom:0, greenTo: maxVal*0.2,\n        yellowFrom: maxVal*0.8, yellowTo: maxVal*0.9,\n        redFrom: maxVal*0.9, redTo: maxVal,\n        minorTicks: 5,\n        // redColor: '#E10098',\n        // greenColor: 'cyan',\n        max: maxVal\n    }\n\n    // draw the chart\n    gauges[title].chart.draw(gauges[title].data, options)\n}\n\n\nfunction getUpperLimit(n) {\n    var lim = 10\n    while (n > lim) lim *= 10\n    return lim\n}\n\n// **********************************************************************************************\n// **********************************************************************************************\n// **********************************************************************************************\n\n\nfunction clearLoginForm() {\n    document.getElementById(\"loginUsername\").value = \"\"\n    document.getElementById(\"loginPassword\").value = \"\"\n    document.getElementById(\"loginCaptcha\").value = \"\"\n    document.getElementById(\"loginPin\").value = \"\"\n    document.getElementById(\"loginError\").innerText = \"\"\n    document.getElementById(\"socialLoginError\").innerHTML = \"\"\n    document.getElementById(\"oauth2email\").innerHTML = \"\"\n}\n\n\nfunction logout() {\n    logoutGraphQLFormSubmit()\n    clearLoginForm()\n    showPage('login',true)\n    isSelfRegAllowed()\n    model.captchaRequired = false\n    return false\n}\n\n\n// refreshData() если пользователь залогинен наполняет модель данными,\n// в противном случае или обнуляет модель.\nfunction refreshData() {\n    if (model.logined) {\n        getAllApps()\n        getAllUsers()\n        getAllGroups()\n        formListAppSubmit()\n        formListUserSubmit()  \n        formListGroupSubmit()  \n    } else {\n        // nullify model's inner props\n        for (const k of Object.keys(model)) {\n            if (k.startsWith('_')) {\n                model[k] = null\n            }\n        }\n        isSelfRegAllowed()\n   }    \n}\n\nfunction getCurrentPageID(){\n    var p = location.hash.slice(1)\n    return (!p || p.includes('=')) ? 'apps' : p\n}\n\n// refreshApp обновляет данные модели и GUI\nfunction refreshApp() {\n    \n    refreshData()\n    \n    if (model.logined) {\n        let page = getCurrentPageID()\n        showPage(page) \n        showElements('#menu')     \n        hideElements('#menuUnlogined')     \n    } else {\n        showPage('login',true)\n        hideElements('#menu')\n        showElements('#menuUnlogined')\n    }  \n    // предзагружаем шаблоны страниц\n    renderTemplateFile('mustache/group.html', model, '#groupPage')\n    renderTemplateFile('mustache/app.html', model, '#appPage')\n    renderTemplateFile('mustache/user.html', model, '#userPage')\n}\n\n\n\nwindow.onhashchange = function(event) {\n    console.debug(\"onhashchange \", event)\n    var newpage = event.newURL.split('#')[1]\n    if (newpage) \n        showPage(newpage)\n}\n\n\nfunction setAppParams(){\n    model.oauth2email = model.urlParams.get('oauth2email') || ''\n    model.oauth2name = model.urlParams.get('oauth2name') || ''\n    model.oauth2id = model.oauth2email.replace(/@.*/,'')\n    document.getElementById('oauth2email').innerHTML = model.oauth2email\n\n    var url = model.urlParams.get('url')\n    var css = model.urlParams.get('css')\n    var oauth2error = model.urlParams.get('oauth2error')\n    var alrt = model.urlParams.get('alert')\n    if (alrt) alert(alrt)\n    document.getElementById('socialLoginError').innerHTML = oauth2error\n    if (css) \n        document.getElementById('theme').href = css\n    model.appurl = url ? url : 'https://auth-proxy.rg.ru'\n    removeQueryStringFromBrowserURL()\n    //?\n    model.captchaRequired = false\n}\n\n\n\nfunction init() {\n    renderTemplateFile('mustache/params.html', model, '#paramsPage')\n    google.charts.load('current', {'packages':['gauge']})\n    google.charts.setOnLoadCallback(getAppstatRest)\n    setAppParams()\n    getLoginedUser()\n    refreshApp()   \n    getParams()   \n}\n\n\n// O N   P A G E   L O A D  ****************************************************************************************\n\ninit()\n"],"names":["delayTimeout","model","oauth2email","oauth2name","oauth2id","priv_origin","appurl","v","this","document","getElementById","innerHTML","buildSocialIcons","href","templatesCache","logined","_loginedUser","urlParams","URLSearchParams","window","location","search","loginedUser","innerText","username","refreshApp","_selfRegAllowed","selfRegAllowed","showElements","hideElements","_captchaRequired","captchaRequired","_authRoles","authRoles","isAdmin","renderTemplateFile","some","e","rolename","_user","user","_app","app","_group","group","_users","users","_apps","apps","_groups","groups","all_app_options","all_user_options","all_group_options","_allApps","allApps","createOptions","_allUsers","allUsers","_allGroups","allGroups","console","debug","all_groups_options","_app_user_roles","app_user_roles","_app_group_roles","app_group_roles","_user_group_roles","user_group_roles","_params","params","app_name","_appstat","appstat","sys","alloc","total_alloc","drawGauge","requests_per_day","requests_per_hour","requests_per_minute","requests_per_second","pd","event","preventDefault","selectValues","valueProp","textProp1","textProp2","output","forEach","value","push","id","join","highlightTab","tabid","removeClass","addClass","split","showPage","pageid","dontpush","stopGettingAppstat","a","pageName","text","querySelector","focus","history","state","pushState","getApp","getUser","getGroup","startGettingAppstat","templateFile","data","targetSelector","cachedTemlpate","renderTemplate","fetch","then","x","template","rendered","Mustache","render","delayFunc","f","delay","clearTimeout","setTimeout","searchApps","checked","searchAppsInModel","formListAppSubmit","trim","replace","r","RegExp","found","filter","s","Object","values","test","sortAppsBy","prop","sort","b","appname","searchUsers","searchUsersInModel","formListUserSubmit","sortUsersBy","asStings","searchGroups","searchGroupsInModel","formListGroupSubmit","sortGroupsBy","groupname","errorMessage","errorElementID","errMsg","doGraphQLRequest","query","responseHandler","method","credentials","body","JSON","stringify","variables","res","ok","json","Error","errors","message","catch","loginGraphQLFormSubmit","password","captcha","pin","isPinRequired","getLoginedUser","clearLoginForm","logoutGraphQLFormSubmit","isSelfRegAllowed","is_selfreg_allowed","checkUserRequirements","isCaptchaRequired","is_captcha_required","is_required","getNewCaptcha","is_pin_required","use_pin","pinrequired","resetPasswordRest","adminurl","origin","pathname","url","error","result","alert","err","resetAuthenticator","get_logined_user","getAuthRoles","list_app_user_role","getParams","p","get_params","getAppstatRest","setParams","set_params","counter","undefined","log","m","clearInterval","statInterval","setInterval","list_user","list","updateUser","refreshData","createUser","u","get_user","appsOfTheUser","fetchGroupsOfTheUser","gr","aur","arr","key","entries","rec","app_description","items","deleteUser","user_id","groupsOfTheUser","list_group_user_role","groupByField","group_id","user_email","group_groupname","group_description","list_app","createApp","description","rebase","_public","sign","updateApp","appOperationName","old_appname","get_app","usersOfTheApp","fetchGroupsOfTheApp","user_fullname","deleteApp","app_id","groupsOfTheApp","list_group_app_role","app_appname","list_group","createGroup","updateGroup","get_group","appsOfTheGroup","records","fieldName","val","app_url","deleteGroup","getAllApps","getAllUsers","getAllGroups","modifyRole","action","onsuccess","modifyGroupAppRole","modifyUserGroupRole","modifyAppGroupRole","filterRows","selector","toLowerCase","querySelectorAll","indexOf","classList","add","remove","toggleElements","toggle","classname","hidePassword","setAttribute","showPassword","removeQueryStringFromBrowserURL","url2","replaceState","newPassword","n","numbers","pickSymbol","Math","floor","random","length","symbolSets","i","generatePassword","generatePinHash","hash","crypto","randomUUID","setPinUrl","input","replaceAll","style","display","t","renderOauthProvidersJSON","jsn","el","icons","k","uri","Date","getTime","src","gauges","title","maxV","containerID","google","visualization","arrayToDataTable","Gauge","container","chart","setValue","maxVal","getUpperLimit","options","height","animation","duration","greenFrom","greenTo","yellowFrom","yellowTo","redFrom","redTo","minorTicks","max","draw","lim","logout","keys","startsWith","getCurrentPageID","slice","includes","setAppParams","get","css","oauth2error","alrt","init","charts","load","packages","setOnLoadCallback","onhashchange","newpage","newURL"],"mappings":"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"}